<script lang="ts" setup>
import type {Drawing} from '@/components/garden/GardenCanvas.vue';

definePageMeta({
    name: 'romy.garden',
});

const CANVAS_SIZE = 200;

const FLOWER_POSITIONS = [
    'left-[7%] top-[75%] z-[5]',
    'left-[25%] top-[45%] z-[3]',
    'left-[42%] top-[90%] z-[7]',
    'left-[52%] top-[22%] z-[1]',
    'left-[64%] top-[58%] z-[4]',
    'left-[81%] top-[82%] z-[6]',
    'left-[93%] top-[42%] z-[2]',
];

const MAX_FLOWERS = 3;

const showGarden = ref<boolean>(false);
const flowers = ref<Array<Drawing>>([
    {
        path: 'M101 52L101 48L100 46L99 46L98 45L98 44L97 43L96 43L96 42L95 41L94 41L93 40L93 39L92 39L90 37L90 36L89 36L88 35L88 36L88 35L87 35L87 34L84 34L84 33L82 33L82 34L76 34L75 35L75 36L74 37L74 39L73 39L73 41L72 42L72 62L72 59L70 57L70 56L69 55L68 53L67 52L67 53L67 51L66 50L65 48L65 47L64 47L63 46L63 45L62 44L61 44L60 42L59 41L58 41L58 40L57 40L56 39L48 39L48 40L47 40L46 41L46 42L44 44L44 46L43 47L43 48L42 50L42 63L43 64L43 66L44 66L45 67L45 68L46 68L46 69L49 72L49 74L50 74L49 74L50 74L50 75L49 75L49 73L48 73L48 72L46 72L45 71L44 71L43 70L41 70L39 69L38 69L37 68L25 68L25 69L24 69L24 70L23 70L23 71L22 72L22 73L21 73L21 75L20 75L20 86L21 86L22 87L23 89L23 90L24 90L27 93L28 93L28 94L30 94L30 95L31 95L32 96L42 96L42 97L44 97L44 98L46 98L46 99L47 99L47 101L46 101L46 102L44 102L44 103L42 103L42 104L32 104L31 105L30 105L30 106L28 106L28 107L27 107L24 110L23 110L23 111L22 113L21 114L20 114L20 125L21 125L21 127L22 127L22 128L23 129L23 130L24 130L24 131L25 131L25 132L37 132L38 131L39 131L41 130L43 130L44 129L45 129L46 128L48 128L48 127L49 127L49 125L50 125L50 126L49 126L50 126L49 126L49 128L46 131L46 132L45 132L45 133L44 134L43 134L43 136L42 137L42 150L43 152L43 153L44 154L44 156L46 158L46 159L47 160L48 160L48 161L56 161L57 160L58 160L58 159L59 159L60 158L61 156L62 156L63 155L63 154L64 153L65 153L65 152L66 150L67 149L67 147L67 148L68 147L69 145L70 144L70 143L72 141L72 138L72 158L73 159L73 161L74 161L74 163L75 164L75 165L76 166L82 166L82 167L84 167L84 166L87 166L87 165L88 165L88 164L88 165L89 164L90 164L90 163L92 161L93 161L93 160L94 159L95 159L96 158L96 157L97 157L98 156L98 155L99 154L100 154L101 152L101 148L99 148L99 152L100 154L101 154L102 155L102 156L103 157L104 157L104 158L105 159L106 159L107 160L107 161L108 161L110 163L110 164L111 164L112 165L112 164L112 165L113 165L113 166L116 166L116 167L118 167L118 166L124 166L125 165L125 164L126 163L126 161L127 161L127 159L128 158L128 138L128 141L130 143L130 144L131 145L132 147L133 148L133 147L133 149L134 150L135 152L135 153L136 153L137 154L137 155L138 156L139 156L140 158L141 159L142 159L142 160L143 160L144 161L152 161L152 160L153 160L154 159L154 158L156 156L156 154L157 153L157 152L158 150L158 137L157 136L157 134L156 134L155 133L155 132L154 132L154 131L151 128L151 126L150 126L151 126L150 126L150 125L151 125L151 127L152 127L152 128L154 128L155 129L156 129L157 130L159 130L161 131L162 131L163 132L175 132L175 131L176 131L176 130L177 130L177 129L178 128L178 127L179 127L179 125L180 125L180 114L179 114L178 113L177 111L177 110L176 110L173 107L172 107L172 106L170 106L170 105L169 105L168 104L158 104L158 103L156 103L156 102L154 102L154 101L153 101L153 99L154 99L154 98L156 98L156 97L158 97L158 96L168 96L169 95L170 95L170 94L172 94L172 93L173 93L176 90L177 90L177 89L178 87L179 86L180 86L180 75L179 75L179 73L178 73L178 72L177 71L177 70L176 70L176 69L175 69L175 68L163 68L162 69L161 69L159 70L157 70L156 71L155 71L154 72L152 72L152 73L151 73L151 75L150 75L150 74L151 74L150 74L151 74L151 72L154 69L154 68L155 68L155 67L156 66L157 66L157 64L158 63L158 50L157 48L157 47L156 46L156 44L154 42L154 41L153 40L152 40L152 39L144 39L143 40L142 40L142 41L141 41L140 42L139 44L138 44L137 45L137 46L136 47L135 47L135 48L134 50L133 51L133 53L133 52L132 53L131 55L130 56L130 57L128 59L128 62L128 42L127 41L127 39L126 39L126 37L125 36L125 35L124 34L118 34L118 33L116 33L116 34L113 34L113 35L112 35L112 36L112 35L111 36L110 36L110 37L108 39L107 39L107 40L106 41L105 41L104 42L104 43L103 43L102 44L102 45L101 46L100 46L99 48L99 52Z',
        color: '#00b7ef',
    },
    {
        path: 'M99 60L99 46L98 46L96 44L95 44L95 43L93 42L93 41L92 40L91 40L89 38L87 38L87 37L86 36L85 36L84 35L79 35L78 36L77 38L75 40L75 42L74 44L73 45L73 47L72 48L72 69L73 69L73 70L74 71L74 69L73 67L72 66L70 62L68 60L68 59L67 58L66 56L65 55L64 53L63 53L62 51L61 51L61 50L59 50L58 49L50 49L49 50L48 52L47 52L47 53L44 56L44 58L43 59L42 61L42 68L43 69L44 69L46 70L47 71L49 71L50 72L53 72L53 73L55 73L56 74L57 74L45 74L43 75L41 75L40 76L39 76L37 77L36 79L35 79L34 81L33 82L32 82L31 84L30 85L30 87L29 87L29 94L31 96L33 96L35 97L44 97L46 96L46 104L44 103L35 103L33 104L31 104L29 106L29 113L30 113L30 115L31 116L32 118L33 118L34 119L35 121L36 121L37 123L39 124L40 124L41 125L43 125L45 126L57 126L56 126L55 127L53 127L53 128L50 128L49 129L47 129L46 130L44 131L43 131L42 132L42 139L43 141L44 142L44 144L47 147L47 148L48 148L49 150L50 151L58 151L59 150L61 150L61 149L62 149L63 147L64 147L65 145L66 144L67 142L68 141L68 140L70 138L72 134L73 133L74 131L74 129L73 130L73 131L72 131L72 152L73 153L73 155L74 156L75 158L75 160L77 162L78 164L79 165L84 165L85 164L86 164L87 163L87 162L89 162L91 160L92 160L93 159L93 158L95 157L95 156L96 156L98 154L99 154L99 140L101 140L101 154L102 154L104 156L105 156L105 157L107 158L107 159L108 160L109 160L111 162L113 162L113 163L114 164L115 164L116 165L121 165L122 164L123 162L125 160L125 158L126 156L127 155L127 153L128 152L128 131L127 131L127 130L126 129L126 131L127 133L128 134L130 138L132 140L132 141L133 142L134 144L135 145L136 147L137 147L138 149L139 149L139 150L141 150L142 151L150 151L151 150L152 148L153 148L153 147L156 144L156 142L157 141L158 139L158 132L157 131L156 131L154 130L153 129L151 129L150 128L147 128L147 127L145 127L144 126L143 126L155 126L157 125L159 125L160 124L161 124L163 123L164 121L165 121L166 119L167 118L168 118L169 116L170 115L170 113L171 113L171 106L169 104L167 104L165 103L156 103L154 104L154 96L156 97L165 97L167 96L169 96L171 94L171 87L170 87L170 85L169 84L168 82L167 82L166 81L165 79L164 79L163 77L161 76L160 76L159 75L157 75L155 74L143 74L144 74L145 73L147 73L147 72L150 72L151 71L153 71L154 70L156 69L157 69L158 68L158 61L157 59L156 58L156 56L153 53L153 52L152 52L151 50L150 49L142 49L141 50L139 50L139 51L138 51L137 53L136 53L135 55L134 56L133 58L132 59L132 60L130 62L128 66L127 67L126 69L126 71L127 70L127 69L128 69L128 48L127 47L127 45L126 44L125 42L125 40L123 38L122 36L121 35L116 35L115 36L114 36L113 37L113 38L111 38L109 40L108 40L107 41L107 42L105 43L105 44L104 44L102 46L101 46L101 60Z',
        color: '#ff2994',
    },
]);

const allFlowersDrawn = computed(() => flowers.value.length >= MAX_FLOWERS);

function createFlower(drawing: Drawing) {
    if (!drawing.path || allFlowersDrawn.value) {
        return;
    }

    flowers.value.push(drawing);
}

function resetGarden() {
    // Clear all flowers.
    flowers.value.splice(0, flowers.value.length);

    // Hide the garden and show the canvas.
    showGarden.value = false;
}
</script>

<template>
    <div class="container mx-auto my-4 flex grow flex-col overflow-hidden px-4 md:my-16">
        <div class="relative mb-4 px-12">
            <UiButtonIcon
                :to="{ name: 'romy.index' }"
                class="!absolute left-0 top-1/2 shrink-0 -translate-y-1/2"
                icon="ph:caret-left"
            />

            <h1 class="text-center">
                {{ $t('garden.title') }}
            </h1>
        </div>

        <div class="flex h-full flex-col items-center justify-center gap-8 lg:gap-16">
            <GardenCanvas
                v-if="!showGarden"
                :canvas-size="CANVAS_SIZE"
                :disabled="allFlowersDrawn"
                @artwork-created="createFlower"
            />

            <div
                v-if="!showGarden"
                class="flex flex-col items-center gap-4"
            >
                <div class="flex gap-4">
                    <div
                        v-for="(_, index) in MAX_FLOWERS"
                        :key="`preview-flower-${index}`"
                        :class="{ 'border-dashed': !flowers[index] }"
                        class="rounded-xl border border-slate-200 bg-gray-950"
                    >
                        <GardenFlower
                            v-if="flowers[index]"
                            :canvas-size="CANVAS_SIZE"
                            :color="flowers[index].color"
                            :petal-path="flowers[index].path"
                            preview
                        />

                        <div
                            v-else
                            class="flex size-24 items-center justify-center lg:size-32"
                        >
                            <Icon
                                name="ph:flower-tulip"
                                size="24"
                            />
                        </div>
                    </div>
                </div>

                <UiButton
                    :disabled="!allFlowersDrawn"
                    :label="$t('garden.actions.see_garden')"
                    @click="showGarden = true"
                />
            </div>

            <div
                v-else
                class="my-8 flex w-full flex-col items-center gap-8"
            >
                <GardenLawn class="flex w-full flex-wrap">
                    <div
                        v-for="(position, index) in FLOWER_POSITIONS"
                        :key="`flower-${position}`"
                        :class="position"
                        class="absolute -translate-x-1/2 -translate-y-full"
                    >
                        <GardenFlower
                            v-if="flowers[index % MAX_FLOWERS]"
                            :canvas-size="CANVAS_SIZE"
                            :color="flowers[index % MAX_FLOWERS].color"
                            :petal-path="flowers[index % MAX_FLOWERS].path"
                        />
                    </div>
                </GardenLawn>

                <UiButton
                    :label="$t('garden.actions.reset')"
                    @click="resetGarden"
                />
            </div>
        </div>
    </div>
</template>
